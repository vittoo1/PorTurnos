# üõí Tiendita - API REST Spring Boot

Este directorio contiene el c√≥digo fuente de la API REST de **Por Turnos**, desarrollada con **Java + Spring Boot**.

---

## üìå Tecnolog√≠as y Herramientas

## üìå Tecnolog√≠as y Herramientas

| Tecnolog√≠a | Versi√≥n | Prop√≥sito |
|------------|---------|-----------|
| **Java** | 24 | Lenguaje de programaci√≥n principal |
| **Spring Boot** | 3.5.4 | Framework web y de aplicaciones |
| **Spring Data JPA** | Incluido | ORM y acceso a datos |
| **Spring Security** | Incluido | Autenticaci√≥n y autorizaci√≥n |
| **JWT** | - | Tokens de seguridad |
| **MySQL** | 8.0+ | Base de datos relacional |
| **Maven** | 3.8+ | Gesti√≥n de dependencias |
| **DBeaver** | Latest | Administraci√≥n de BD |
| **Bruno** | Latest | Testing de APIs |

---

## üìÇ Estructura de Paquetes

Dentro de `tiendita/` la estructura es la siguiente:

```
tiendita/
‚îú‚îÄ‚îÄ üìÑ .env                    # Variables de entorno
‚îú‚îÄ‚îÄ üìÑ pom.xml                 # Configuraci√≥n Maven
‚îú‚îÄ‚îÄ üìÑ README.md               # Este archivo
‚îú‚îÄ‚îÄ üìÅ src/
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ main/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ java/com/bootcamp/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ TienditaApplication.java      # Clase principal
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ config/                       # Configuraciones
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WebConfig.java               # CORS, interceptors
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DatabaseConfig.java          # Configuraci√≥n DB
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ controller/                   # Controladores REST
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthController.java          # Autenticaci√≥n
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClienteController.java       # Gesti√≥n clientes
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProductoController.java      # Gesti√≥n productos
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ComentarioController.java    # Sistema comentarios
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BlogController.java          # Blog comunitario
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ VentaController.java         # Transacciones
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ model/                        # Entidades del dominio
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Cliente.java                 # Entidad Cliente
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Producto.java                # Entidad Producto
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Comentario.java              # Entidad Comentario
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Blog.java                    # Entidad Blog
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Venta.java                   # Entidad Venta
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ enums/                    # Enumeraciones
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ EstadoProducto.java      # NUEVO|SEMI_NUEVO|USADO
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ DisponibilidadProducto.java # DISPONIBLE|VENDIDO|PAUSADO
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ EstadoVenta.java         # PENDIENTE|CONFIRMADA|ENTREGADA|CANCELADA
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ MetodoPago.java          # EFECTIVO|TRANSFERENCIA|etc.
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ repository/                   # Acceso a datos (JPA)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClienteRepository.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProductoRepository.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ComentarioRepository.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BlogRepository.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ VentaRepository.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ security/                     # Seguridad y JWT
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ jwt/                      # JWT Utils
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ model/                    # Modelos de seguridad
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ repository/               # Repos de seguridad
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ web/                      # Controllers de auth
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ service/                      # L√≥gica de negocio
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ClienteService.java
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ProductoService.java
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ComentarioService.java
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ BlogService.java
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ VentaService.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ resources/                        # Configuraci√≥n y recursos
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ application.yml                  # Configuraci√≥n principal
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ application-dev.yml              # Perfil desarrollo
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ application-prod.yml             # Perfil producci√≥n
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ schema.sql                       # Scripts SQL iniciales
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ test/                                 # Pruebas unitarias
‚îÇ       ‚îî‚îÄ‚îÄ üìÅ java/com/bootcamp/
‚îÇ           ‚îú‚îÄ‚îÄ TienditaApplicationTests.java
‚îÇ           ‚îî‚îÄ‚îÄ üìÅ controller/                   # Tests de controladores
‚îî‚îÄ‚îÄ üìÅ target/                                   # Archivos compilados (generado)
```

---

## ‚ñ∂ Configuraci√≥n y Ejecuci√≥n

### Prerrequisitos del Sistema

```bash
# Verificar versiones instaladas
java --version    # Debe ser 17 o superior
mvn --version     # Maven 3.8+
mysql --version   # MySQL 8.0+
```

1. Configura las variables de conexi√≥n a MySQL en `application.yml` o `.env`.

2. Ejecuta:

```bash
mvn spring-boot:run
```

3. API disponible en:http://localhost:8080

---

## üèóÔ∏è Arquitectura y Patrones de Dise√±o

### Patrones Implementados

- **üèõÔ∏è MVC (Model-View-Controller)**: Separaci√≥n clara de responsabilidades
- **üîå Repository Pattern**: Abstracci√≥n del acceso a datos
- **üéØ Service Layer**: L√≥gica de negocio centralizada
- **üíâ Dependency Injection**: Inversi√≥n de control con Spring
- **üõ°Ô∏è JWT Token Authentication**: Seguridad stateless
- **üìÑ DTO Pattern**: Transferencia de datos optimizada

### Flujo de una Request

```
Cliente HTTP Request
        ‚Üì
   üîê Security Filter (JWT)
        ‚Üì
   üéÆ Controller (REST Endpoints)
        ‚Üì
   üéØ Service (Business Logic)
        ‚Üì
   üîå Repository (Data Access)
        ‚Üì
   üóÑÔ∏è Database (MySQL)
```

---

## üîê Reglas de Negocio y Validaciones

### Reglas Principales

| Entidad | Regla de Negocio |
|---------|------------------|
| **üë§ Clientes** | Pueden ser compradores, vendedores o ambos roles |
| **üé≤ Productos** | Estado y disponibilidad cambian seg√∫n transacciones |
| **üí∞ Ventas** | Registran m√©todo de pago, estado y datos de entrega |
| **üí¨ Comentarios** | Siempre pertenecen a un producto y un cliente espec√≠fico |
| **üìù Blogs** | Solo clientes registrados pueden publicar contenido |

---

## Esquema de Tablas

### üë§ `clientes`
- `id` BIGINT PK, AUTO_INCREMENT  
- `rut` VARCHAR(12) NOT NULL **UNIQUE**  
- `nombres` VARCHAR(100) NOT NULL  
- `apellidos` VARCHAR(100) NOT NULL  
- `email` VARCHAR(100) NOT NULL **UNIQUE**  
- `telefono` VARCHAR(20)  
- `direccion` VARCHAR(255) NOT NULL  
- `fecha_registro` TIMESTAMP DEFAULT CURRENT_TIMESTAMP  

> Un cliente puede comprar y/o vender productos.

---

### üé≤ `productos`
- `id` BIGINT PK, AUTO_INCREMENT  
- `cliente_id` BIGINT NOT NULL **FK** ‚Üí `clientes(id)`  
- `nombre_producto` VARCHAR(120) NOT NULL  
- `descripcion` VARCHAR(300) NOT NULL  
- `imagen` TEXT (URL)  
- `precio` DECIMAL(10,2) NOT NULL CHECK (`precio` ‚â• 0)  
- `cantidad` INT NOT NULL  
- `categoria` VARCHAR(50)  
- `estado` ENUM(`nuevo`, `semi_nuevo`, `usado`) DEFAULT `usado`  
- `disponibilidad` ENUM(`disponible`, `vendido`, `pausado`) DEFAULT `disponible`  
- `fecha_publicacion` TIMESTAMP DEFAULT CURRENT_TIMESTAMP  

---

### üí¨ `comentarios`
- `id` BIGINT PK, AUTO_INCREMENT  
- `cliente_id` BIGINT NOT NULL **FK** ‚Üí `clientes(id)`  
- `producto_id` BIGINT NOT NULL **FK** ‚Üí `productos(id)`  
- `nombre_comentario` VARCHAR(50) NOT NULL  
- `texto` VARCHAR(300) NOT NULL  
- `fecha_comentario` TIMESTAMP DEFAULT CURRENT_TIMESTAMP  

---

### üìù `blogs`
- `id` BIGINT PK, AUTO_INCREMENT  
- `cliente_id` BIGINT NOT NULL **FK** ‚Üí `clientes(id)`  
- `categoria` VARCHAR(50) NOT NULL  
- `titulo` VARCHAR(50) NOT NULL  
- `cuerpo_blog` TEXT NOT NULL  
- `imagen` TEXT  
- `fecha_publicacion` TIMESTAMP DEFAULT CURRENT_TIMESTAMP  

---

### üí∞ `ventas`
- `id` BIGINT PK, AUTO_INCREMENT  
- `producto_id` BIGINT NOT NULL **FK** ‚Üí `productos(id)`  
- `cliente_comprador_id` BIGINT NOT NULL **FK** ‚Üí `clientes(id)`  
- `cliente_vendedor_id` BIGINT NOT NULL **FK** ‚Üí `clientes(id)`  
- `precio_venta` DECIMAL(10,2) NOT NULL CHECK (`precio_venta` ‚â• 0)  
- `cantidad_vendida` INT NOT NULL CHECK (`cantidad_vendida` > 0)  
- `total` DECIMAL(10,2) NOT NULL CHECK (`total` ‚â• 0)  
- `metodo_pago` ENUM(`efectivo`, `transferencia`, `tarjeta_cr√©dito`, `tarjeta_debito`, `paypal`, `mercadopago`) NOT NULL  
- `estado_venta` ENUM(`pendiente`, `confirmada`, `entregada`, `cancelada`) DEFAULT `pendiente`  
- `direccion_entrega` VARCHAR(255) NOT NULL  
- `telefono_contacto` VARCHAR(20)  
- `observaciones` TEXT  
- `fecha_venta` TIMESTAMP DEFAULT CURRENT_TIMESTAMP  
- `fecha_entrega` TIMESTAMP NULL  
- **√çndices**:  
  - `idx_producto_id (producto_id)`  
  - `idx_cliente_comprador (cliente_comprador_id)`  
  - `idx_cliente_vendedor (cliente_vendedor_id)`  
  - `idx_fecha_venta (fecha_venta)`  
  - `idx_estado_venta (estado_venta)`

---

## üîó Relaciones y Cardinalidades

### Diagrama ER Completo

```mermaid
erDiagram
    CLIENTES ||--o{ PRODUCTOS : "publica (1:N)"
    CLIENTES ||--o{ COMENTARIOS : "escribe (1:N)"
    PRODUCTOS ||--o{ COMENTARIOS : "recibe (1:N)"
    CLIENTES ||--o{ BLOGS : "publica (1:N)"
    PRODUCTOS ||--o{ VENTAS : "se_vende_en (1:N)"
    CLIENTES ||--o{ VENTAS : "compra (1:N)"
    CLIENTES ||--o{ VENTAS : "vende (1:N)"

    CLIENTES {
        BIGINT id PK "üîë Clave primaria"
        VARCHAR(12) rut UK "üÜî Identificador √∫nico"
        VARCHAR(100) nombres "üë§ Nombres"
        VARCHAR(100) apellidos "üë§ Apellidos"
        VARCHAR(100) email UK "üìß Email √∫nico"
        VARCHAR(255) password "üîê Password encriptado"
        VARCHAR(20) telefono "üìû Tel√©fono"
        VARCHAR(255) direccion "üè† Direcci√≥n"
        BOOLEAN enabled "‚úÖ Cuenta activa"
        TIMESTAMP fecha_registro "üìÖ Fecha registro"
    }

    PRODUCTOS {
        BIGINT id PK "üîë Clave primaria"
        BIGINT cliente_id FK "üë§ Vendedor"
        VARCHAR(120) nombre_producto "üé≤ Nombre juego"
        VARCHAR(300) descripcion "üìù Descripci√≥n"
        TEXT imagen "üñºÔ∏è URL imagen"
        DECIMAL(10,2) precio "üí∞ Precio"
        INT cantidad "üì¶ Stock"
        VARCHAR(50) categoria "üè∑Ô∏è Categor√≠a"
        ENUM estado "üÜï NUEVO|SEMI_NUEVO|USADO"
        ENUM disponibilidad "üìä DISPONIBLE|VENDIDO|PAUSADO"
        TIMESTAMP fecha_publicacion "üìÖ Fecha publicaci√≥n"
    }

    COMENTARIOS {
        BIGINT id PK "üîë Clave primaria"
        BIGINT cliente_id FK "üë§ Autor"
        BIGINT producto_id FK "üé≤ Producto"
        VARCHAR(50) nombre_comentario "üìù T√≠tulo"
        VARCHAR(300) texto "üí¨ Contenido"
        TINYINT calificacion "‚≠ê Rating 1-5"
        TIMESTAMP fecha_comentario "üìÖ Fecha"
    }

    BLOGS {
        BIGINT id PK "üîë Clave primaria"
        BIGINT cliente_id FK "üë§ Autor"
        VARCHAR(50) categoria "üè∑Ô∏è Categor√≠a"
        VARCHAR(50) titulo "üì∞ T√≠tulo"
        TEXT cuerpo_blog "üìù Contenido"
        TEXT imagen "üñºÔ∏è Imagen destacada"
        BOOLEAN publicado "üöÄ Publicado"
        TIMESTAMP fecha_publicacion "üìÖ Fecha"
    }

    VENTAS {
        BIGINT id PK "üîë Clave primaria"
        BIGINT producto_id FK "üé≤ Producto"
        BIGINT cliente_comprador_id FK "üõí Comprador"
        BIGINT cliente_vendedor_id FK "üíº Vendedor"
        DECIMAL(10,2) precio_venta "üí∞ Precio final"
        INT cantidad_vendida "üì¶ Cantidad"
        DECIMAL(10,2) total "üíµ Total"
        ENUM metodo_pago "üí≥ M√©todo pago"
        ENUM estado_venta "üìä Estado"
        VARCHAR(255) direccion_entrega "üöö Direcci√≥n"
        VARCHAR(20) telefono_contacto "üìû Contacto"
        TEXT observaciones "üìù Notas"
        TIMESTAMP fecha_venta "üìÖ Fecha venta"
        TIMESTAMP fecha_entrega "üìÖ Fecha entrega"
    }
```

### Reglas de Integridad Referencial

| Relaci√≥n | Tipo | Acci√≥n DELETE | Acci√≥n UPDATE |
|----------|------|---------------|---------------|
| `productos.cliente_id ‚Üí clientes.id` | 1:N | CASCADE | CASCADE |
| `comentarios.cliente_id ‚Üí clientes.id` | 1:N | CASCADE | CASCADE |
| `comentarios.producto_id ‚Üí productos.id` | 1:N | CASCADE | CASCADE |
| `blogs.cliente_id ‚Üí clientes.id` | 1:N | CASCADE | CASCADE |
| `ventas.producto_id ‚Üí productos.id` | 1:N | RESTRICT | CASCADE |
| `ventas.cliente_comprador_id ‚Üí clientes.id` | 1:N | RESTRICT | CASCADE |
| `ventas.cliente_vendedor_id ‚Üí clientes.id` | 1:N | RESTRICT | CASCADE |

---

## üõ† Tecnolog√≠as Utilizadas

### Stack Backend Completo

## üõ† Tecnolog√≠as Utilizadas

### Stack Backend Completo

| Capa / Rol           | Tecnolog√≠a                              | Versi√≥n                          | Descripci√≥n |
|----------------------|------------------------------------------|----------------------------------|-------------|
| **üîß Build Tool**    | Maven                                    | 3.8+                             | Gesti√≥n de dependencias y construcci√≥n del proyecto |
| **‚òï Runtime**       | OpenJDK                                  | 21                               | M√°quina virtual Java para ejecutar la aplicaci√≥n |
| **üå± Framework**     | Spring Boot                              | 3.5.4                            | Framework para desarrollo r√°pido de aplicaciones Java |
| **üîå Data Access**   | Spring Data JPA                          | Gestionado por Spring Boot 3.5.4 | ORM y repositorios para acceso a datos |
| **üõ°Ô∏è Security**     | Spring Security                          | Gestionado por Spring Boot 3.5.4 | Autenticaci√≥n, autorizaci√≥n y seguridad |
| **üóÑÔ∏è Database**     | MySQL (mysql-connector-j)                | Gestionado por Spring Boot 3.5.4 | Conector JDBC para MySQL |
| **üîë Authentication**| JJWT (io.jsonwebtoken)                   | 0.11.5                           | Manejo de tokens JWT para autenticaci√≥n |
| **üìä Connection Pool**| HikariCP                                | Gestionado por Spring Boot 3.5.4 | Pool de conexiones por defecto en Spring Boot |
| **üß∞ Validaci√≥n**    | Spring Boot Starter Validation           | Gestionado por Spring Boot 3.5.4 | Bean Validation con Jakarta |
| **‚öôÔ∏è Devtools**      | Spring Boot DevTools                     | Gestionado (scope runtime)       | Hot reload y herramientas para desarrollo |
| **üß© Config**        | spring-dotenv (me.paulschwarz)           | 3.0.0                            | Manejo de variables de entorno desde `.env` |
| **üßµ Lombok**        | Project Lombok                           | 1.18.38                          | Reducci√≥n de c√≥digo repetitivo con anotaciones |
| **üõ† DB Tool**       | DBeaver                                  | Local                            | Cliente para administraci√≥n y modelado de bases de datos |
| **üì¶ API Testing**   | Bruno                                    | Local                            | Herramienta para pruebas y documentaci√≥n de endpoints |
| **üõ† Control Versiones**| Git + GitHub                          | -                                | Control de versiones y repositorio remoto |

---

## Consultas de Ejemplo

```sql
-- √öltimos 10 productos disponibles
SELECT p.*
FROM productos p
WHERE p.disponibilidad = 'disponible'
ORDER BY p.fecha_publicacion DESC
LIMIT 10;

-- Comentarios de un producto
SELECT c.nombre_comentario, c.texto, c.fecha_comentario, cli.nombres, cli.apellidos
FROM comentarios c
JOIN clientes cli ON cli.id = c.cliente_id
WHERE c.producto_id = ? 
ORDER BY c.fecha_comentario DESC;

-- Ventas por estado y fecha
SELECT estado_venta, COUNT(*) AS total
FROM ventas
WHERE fecha_venta >= CURDATE() - INTERVAL 30 DAY
GROUP BY estado_venta;

-- Top vendedores por monto vendido
SELECT v.cliente_vendedor_id, cli.nombres, cli.apellidos, SUM(v.total) AS monto_total
FROM ventas v
JOIN clientes cli ON cli.id = v.cliente_vendedor_id
GROUP BY v.cliente_vendedor_id, cli.nombres, cli.apellidos
ORDER BY monto_total DESC
LIMIT 5;
```
---